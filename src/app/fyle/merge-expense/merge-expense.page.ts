import { Component, OnInit } from '@angular/core';
import { FormControl, FormGroup } from '@angular/forms';
import { Router } from '@angular/router';
import { from } from 'rxjs';
import { map, switchMap, tap } from 'rxjs/operators';
import { Expense } from 'src/app/core/models/expense.model';

@Component({
  selector: 'app-merge-expense',
  templateUrl: './merge-expense.page.html',
  styleUrls: ['./merge-expense.page.scss'],
})
export class MergeExpensePage implements OnInit {
  expenses: Expense[];

  mergedExpense = {};

  fg: FormGroup;

  options;

  constructor(private router: Router) {}

  ngOnInit() {
    this.fg = new FormGroup({
      selectedId: new FormControl(),
    });
    this.options = [1, 2];
    // this.expenses = this.router.getCurrentNavigation().extras.state.selectedElements;
    const expenses = `
    [{"_search_document":"'55':1 '55.00':2 'ajain@fyle.in':7 'complete':4 'e/2021/11/t/2':5 'inr':3 'others':8,9,10 'yash':6","duplicates":[{"fields":["amount","currency","txn_dt"],"percent":33,"reason":"(Accuracy rate: 33%) The amount, currency, date of spend of this expense match with another expense.","transaction_id":"txhV3sTkmV5s"}],"external_expense_id":null,"matched_by":null,"ou_band":null,"ou_business_unit":null,"ou_department":null,"ou_department_id":null,"ou_employee_id":null,"ou_id":"oulhcY7LQ4fS","ou_joining_dt":null,"ou_level":null,"ou_location":null,"ou_mobile":"+919535079878","ou_org_id":"orR5DdAEXfeK","ou_org_name":"CCC-Statement","ou_rank":null,"ou_sub_department":null,"ou_title":null,"ou_user_id":"usvKA4X8Ugcr","rp_approved_at":null,"rp_claim_number":null,"rp_purpose":null,"rp_reimbursed_at":null,"source_account_id":"accxhd4TdFVYS","source_account_type":"PERSONAL_ACCOUNT","tg_name":null,"tg_percentage":null,"transaction_approvals":null,"tx_activity_details":null,"tx_activity_policy_pending":null,"tx_admin_amount":null,"tx_amount":55,"tx_billable":false,"tx_boolean_column1":null,"tx_boolean_column10":null,"tx_boolean_column2":null,"tx_boolean_column3":null,"tx_boolean_column4":null,"tx_boolean_column5":null,"tx_boolean_column6":null,"tx_boolean_column7":null,"tx_boolean_column8":null,"tx_boolean_column9":null,"tx_bus_travel_class":null,"tx_category":null,"tx_corporate_credit_card_expense_group_id":null,"tx_cost_center_code":"1","tx_cost_center_id":2425,"tx_cost_center_name":"a2","tx_created_at":"2021-11-18T11:20:02.036696","tx_creator_id":"oulhcY7LQ4fS","tx_currency":"INR","tx_custom_properties":[],"tx_decimal_column1":null,"tx_decimal_column10":null,"tx_decimal_column2":null,"tx_decimal_column3":null,"tx_decimal_column4":null,"tx_decimal_column5":null,"tx_decimal_column6":null,"tx_decimal_column7":null,"tx_decimal_column8":null,"tx_decimal_column9":null,"tx_distance":null,"tx_distance_unit":null,"tx_expense_number":"E/2021/11/T/2","tx_external_id":null,"tx_extracted_data":null,"tx_file_ids":null,"tx_flight_journey_travel_class":null,"tx_flight_return_travel_class":null,"tx_from_dt":null,"tx_fyle_category":"Others","tx_hotel_is_breakfast_provided":null,"tx_id":"txhKMraNUpFv","tx_invoice_number":null,"tx_is_duplicate_expense":null,"tx_is_holiday_expense":null,"tx_is_split_expense":false,"tx_location_column1":null,"tx_location_column10":null,"tx_location_column2":null,"tx_location_column3":null,"tx_location_column4":null,"tx_location_column5":null,"tx_location_column6":null,"tx_location_column7":null,"tx_location_column8":null,"tx_location_column9":null,"tx_locations":[],"tx_mandatory_fields_present":true,"tx_manual_flag":false,"tx_mileage_calculated_amount":null,"tx_mileage_calculated_distance":null,"tx_mileage_is_round_trip":null,"tx_mileage_rate":null,"tx_mileage_vehicle_type":null,"tx_num_days":null,"tx_num_files":0,"tx_org_category":"Others","tx_org_category_code":null,"tx_org_category_id":37028,"tx_org_user_id":"oulhcY7LQ4fS","tx_orig_amount":null,"tx_orig_currency":null,"tx_payment_id":"payLGBQYfgu3X","tx_per_diem_rate_id":null,"tx_physical_bill":false,"tx_physical_bill_at":null,"tx_policy_amount":null,"tx_policy_flag":true,"tx_policy_state":null,"tx_project_code":null,"tx_project_id":null,"tx_project_name":null,"tx_purpose":null,"tx_receipt_required":true,"tx_report_id":null,"tx_reported_at":null,"tx_risk_state":null,"tx_skip_reimbursement":false,"tx_source":"MOBILE","tx_source_account_id":"accxhd4TdFVYS","tx_split_group_id":"txhKMraNUpFv","tx_split_group_user_amount":55,"tx_state":"COMPLETE","tx_sub_category":"Others","tx_tax":null,"tx_tax_amount":null,"tx_tax_group_id":null,"tx_text_array_column1":null,"tx_text_array_column10":null,"tx_text_array_column2":null,"tx_text_array_column3":null,"tx_text_array_column4":null,"tx_text_array_column5":null,"tx_text_array_column6":null,"tx_text_array_column7":null,"tx_text_array_column8":null,"tx_text_array_column9":null,"tx_text_column1":null,"tx_text_column10":null,"tx_text_column11":null,"tx_text_column12":null,"tx_text_column13":null,"tx_text_column14":null,"tx_text_column15":null,"tx_text_column2":null,"tx_text_column3":null,"tx_text_column4":null,"tx_text_column5":null,"tx_text_column6":null,"tx_text_column7":null,"tx_text_column8":null,"tx_text_column9":null,"tx_timestamp_column1":null,"tx_timestamp_column10":null,"tx_timestamp_column2":null,"tx_timestamp_column3":null,"tx_timestamp_column4":null,"tx_timestamp_column5":null,"tx_timestamp_column6":null,"tx_timestamp_column7":null,"tx_timestamp_column8":null,"tx_timestamp_column9":null,"tx_to_dt":null,"tx_train_travel_class":null,"tx_transcribed_data":null,"tx_transcription_state":null,"tx_txn_dt":"2021-11-18T01:00:00.000Z","tx_updated_at":"2021-11-18T11:20:10.511","tx_user_amount":55,"tx_user_can_delete":true,"tx_user_reason_for_duplicate_expenses":null,"tx_user_review_needed":null,"tx_vendor":null,"tx_vendor_id":null,"tx_verification_state":null,"us_email":"ajain@fyle.in","us_full_name":"Yash","isDraft":false,"isPolicyViolated":true,"isCriticalPolicyViolated":false,"vendorDetails":null},{"_search_document":"'55':1 '55.00':2 'ajain@fyle.in':7 'complete':4 'e/2021/11/t/1':5 'inr':3 'others':8,9,10 'yash':6","duplicates":[{"fields":["amount","currency","txn_dt"],"percent":33,"reason":"(Accuracy rate: 33%) The amount, currency, date of spend of this expense match with another expense.","transaction_id":"txhKMraNUpFv"}],"external_expense_id":null,"matched_by":null,"ou_band":null,"ou_business_unit":null,"ou_department":null,"ou_department_id":null,"ou_employee_id":null,"ou_id":"oulhcY7LQ4fS","ou_joining_dt":null,"ou_level":null,"ou_location":null,"ou_mobile":"+919535079878","ou_org_id":"orR5DdAEXfeK","ou_org_name":"CCC-Statement","ou_rank":null,"ou_sub_department":null,"ou_title":null,"ou_user_id":"usvKA4X8Ugcr","rp_approved_at":null,"rp_claim_number":null,"rp_purpose":null,"rp_reimbursed_at":null,"source_account_id":"accxhd4TdFVYS","source_account_type":"PERSONAL_ACCOUNT","tg_name":null,"tg_percentage":null,"transaction_approvals":null,"tx_activity_details":null,"tx_activity_policy_pending":null,"tx_admin_amount":null,"tx_amount":55,"tx_billable":false,"tx_boolean_column1":null,"tx_boolean_column10":null,"tx_boolean_column2":null,"tx_boolean_column3":null,"tx_boolean_column4":null,"tx_boolean_column5":null,"tx_boolean_column6":null,"tx_boolean_column7":null,"tx_boolean_column8":null,"tx_boolean_column9":null,"tx_bus_travel_class":null,"tx_category":null,"tx_corporate_credit_card_expense_group_id":null,"tx_cost_center_code":"1","tx_cost_center_id":2425,"tx_cost_center_name":"a2","tx_created_at":"2021-11-18T11:19:48.044044","tx_creator_id":"oulhcY7LQ4fS","tx_currency":"INR","tx_custom_properties":[],"tx_decimal_column1":null,"tx_decimal_column10":null,"tx_decimal_column2":null,"tx_decimal_column3":null,"tx_decimal_column4":null,"tx_decimal_column5":null,"tx_decimal_column6":null,"tx_decimal_column7":null,"tx_decimal_column8":null,"tx_decimal_column9":null,"tx_distance":null,"tx_distance_unit":null,"tx_expense_number":"E/2021/11/T/1","tx_external_id":null,"tx_extracted_data":null,"tx_file_ids":null,"tx_flight_journey_travel_class":null,"tx_flight_return_travel_class":null,"tx_from_dt":null,"tx_fyle_category":"Others","tx_hotel_is_breakfast_provided":null,"tx_id":"txhV3sTkmV5s","tx_invoice_number":null,"tx_is_duplicate_expense":null,"tx_is_holiday_expense":null,"tx_is_split_expense":false,"tx_location_column1":null,"tx_location_column10":null,"tx_location_column2":null,"tx_location_column3":null,"tx_location_column4":null,"tx_location_column5":null,"tx_location_column6":null,"tx_location_column7":null,"tx_location_column8":null,"tx_location_column9":null,"tx_locations":[],"tx_mandatory_fields_present":true,"tx_manual_flag":false,"tx_mileage_calculated_amount":null,"tx_mileage_calculated_distance":null,"tx_mileage_is_round_trip":null,"tx_mileage_rate":null,"tx_mileage_vehicle_type":null,"tx_num_days":null,"tx_num_files":0,"tx_org_category":"Others","tx_org_category_code":null,"tx_org_category_id":37028,"tx_org_user_id":"oulhcY7LQ4fS","tx_orig_amount":null,"tx_orig_currency":null,"tx_payment_id":"payKH2meul0cg","tx_per_diem_rate_id":null,"tx_physical_bill":false,"tx_physical_bill_at":null,"tx_policy_amount":null,"tx_policy_flag":true,"tx_policy_state":null,"tx_project_code":null,"tx_project_id":null,"tx_project_name":null,"tx_purpose":null,"tx_receipt_required":true,"tx_report_id":null,"tx_reported_at":null,"tx_risk_state":null,"tx_skip_reimbursement":false,"tx_source":"MOBILE","tx_source_account_id":"accxhd4TdFVYS","tx_split_group_id":"txhV3sTkmV5s","tx_split_group_user_amount":55,"tx_state":"COMPLETE","tx_sub_category":"Others","tx_tax":null,"tx_tax_amount":null,"tx_tax_group_id":null,"tx_text_array_column1":null,"tx_text_array_column10":null,"tx_text_array_column2":null,"tx_text_array_column3":null,"tx_text_array_column4":null,"tx_text_array_column5":null,"tx_text_array_column6":null,"tx_text_array_column7":null,"tx_text_array_column8":null,"tx_text_array_column9":null,"tx_text_column1":null,"tx_text_column10":null,"tx_text_column11":null,"tx_text_column12":null,"tx_text_column13":null,"tx_text_column14":null,"tx_text_column15":null,"tx_text_column2":null,"tx_text_column3":null,"tx_text_column4":null,"tx_text_column5":null,"tx_text_column6":null,"tx_text_column7":null,"tx_text_column8":null,"tx_text_column9":null,"tx_timestamp_column1":null,"tx_timestamp_column10":null,"tx_timestamp_column2":null,"tx_timestamp_column3":null,"tx_timestamp_column4":null,"tx_timestamp_column5":null,"tx_timestamp_column6":null,"tx_timestamp_column7":null,"tx_timestamp_column8":null,"tx_timestamp_column9":null,"tx_to_dt":null,"tx_train_travel_class":null,"tx_transcribed_data":null,"tx_transcription_state":null,"tx_txn_dt":"2021-11-18T01:00:00.000Z","tx_updated_at":"2021-11-18T11:19:52.82829","tx_user_amount":55,"tx_user_can_delete":true,"tx_user_reason_for_duplicate_expenses":null,"tx_user_review_needed":null,"tx_vendor":null,"tx_vendor_id":null,"tx_verification_state":null,"us_email":"ajain@fyle.in","us_full_name":"Yash","isDraft":false,"isPolicyViolated":true,"isCriticalPolicyViolated":false,"vendorDetails":null}]
    `;
    this.expenses = JSON.parse(expenses);
    console.log(this.expenses);
    from(Object.keys(this.expenses[0])).subscribe((item) => {
      this.mergedExpense[item] = [];
      if (this.expenses[0][item]) {
        this.mergedExpense[item].push(this.expenses[0][item]);
      }
      if (this.expenses[1][item]) {
        this.mergedExpense[item].push(this.expenses[1][item]);
      }
    });

    console.log(this.mergedExpense);
  }
}
